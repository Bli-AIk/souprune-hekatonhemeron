早在 SOUPRune 这个名字刚被我想出来时，脚本化就已经得排在日程上了。它的 U 和 P ―― User-friendly 与 Popular... 就需要我们构造 **多语言脚本层**，并 **兼容 DR/UT 社区主流生态与使用习惯**。

但 ECS 如何与脚本兼容呢？

关键在于把握好脚本能做的度。如何让脚本能做到它该做的，同时又不越界――不让代码耦合起来？

做法就是，不变逻辑交给 Rust ECS；可变逻辑交给脚本。

什么是可变逻辑呢...？overworld事件系统、背包物品定义、buff、弹幕、回合选项。做 fangame，改这些就够了吧？

哦对，还有一个对话与对话事件，那就是使用 mortar 写东西啦。大概也算是个脚本吧。顺带一提的就是，我们的项目中应该让 mortar 也能绑定脚本语言。

# 07 - 预制菜品

预制菜这东西有它的好处，反正我们做东西又不是明码标价的，没那么多争议。我肯定不能指望大伙儿都懂 rust... 甚至是，只是都懂 ecs，对吧？那给大伙一人发一包泡面，那至少煮着吃，加个蛋啥的都不难... 真不行也能泡热水啊。要是热水还不行，那我没辙了。

毫无疑问，最早支持脚本层的就是 unitale 与它的现代 fork CYF。虽然我印象里面这俩玩意儿在国内不是很流行...我也不知道现在啥样了，但就我看其文档的详细程度，还是挺令我震惊的。

所以我们总体的 API 设计以参考 CYF 为主，毕竟人家太权威了。优先实现 Lua 的兼容，然后再说别的。嗯哼。

后文中一概简称 Unitale / CYF 为 CYF。~~（谁家 GNU / Linux）~~

## 塑料包装

CYF 的定位是一个 mod 加载器。这事儿其实非常有意思，我现在也觉得这种架构是非常有前瞻性的――首先，我们自然地区分了核心框架和脚本层，能够让用户按需使用；其次，用户编写的东西按理来说也都得是开源的。开源难道不好吗？反正我是觉得开源就是好。再其次是啥我编不出来了。

但也有缺点... 就是 CYF 开启的时候有个 mod 菜单啥的。可能某些想做全流程的膈应这个吧。我也不清楚 CYF 现在能不能配置默认启动项... 但无所谓，我会出手。

如果说 CYF 把 mod 按照菜单列出，是“分类包装”，那咱就是“塑料包装”，让用户用配置菜单...之类的东西，选择默认启动项，然后打开游戏就是对应的项目。哇哦，这不挺好的么？

当然也可以配置成显示 mod 列表啥的...哎呀，再说吧。反正我的第一意向就是，可以配置默认启动的脚本项目。

对的，我们也不叫 mod... 叫 project。项目。嗯哼。