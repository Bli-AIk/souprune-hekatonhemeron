早在 SOUPRune 这个名字刚被我想出来时，脚本化就已经得排在日程上了。它的 U 和 P ―― User-friendly 与 Popular... 就需要我们构造 **多语言脚本层**，并 **兼容 DR/UT 社区主流生态与使用习惯**。

但 ECS 如何与脚本兼容呢？

关键在于把握好脚本能做的度。如何让脚本能做到它该做的，同时又不越界――不让代码耦合起来？

做法就是，不变逻辑交给 Rust ECS；可变逻辑交给脚本。

什么是可变逻辑呢...？overworld事件系统、背包物品定义、buff、弹幕、回合选项。做 fangame，改这些就够了吧？

哦对，还有一个对话与对话事件，那就是使用 mortar 写东西啦。大概也算是个脚本吧。顺带一提的就是，我们的项目中应该让 mortar 也能绑定脚本语言。

# 07 - 预制菜品

预制菜这东西有它的好处，反正我们做东西又不是明码标价的，没那么多争议。我肯定不能指望大伙儿都懂 rust... 甚至是，只是都懂 ecs，对吧？那给大伙一人发一包泡面，那至少煮着吃，加个蛋啥的都不难... 真不行也能泡热水啊。要是热水还不行，那我没辙了。

毫无疑问，最早支持脚本层的就是 unitale 与它的现代 fork CYF。虽然我印象里面这俩玩意儿在国内不是很流行...我也不知道现在啥样了，但就我看其文档的详细程度，还是挺令我震惊的。

所以我们总体的 API 设计以参考 CYF 为主，毕竟人家太权威了。优先实现 Lua 的兼容，然后再说别的。嗯哼。

后文中由于会多次提到 Unitale / CYF 的各种信息，如 API。尽管两者 API 存在差异，但我们总共是参考两者的 API，且更多参考 CYF。所以，后文一概简称 Unitale / CYF 为 CYF。~~（谁家 GNU / Linux）~~

## 塑料包装

CYF 的定位是一个 mod 加载器。这事儿其实非常有意思，我现在也觉得这种架构是非常有前瞻性的――首先，我们自然地区分了核心框架和脚本层，能够让用户按需使用；其次，用户编写的东西按理来说也都得是开源的。开源难道不好吗？反正我是觉得开源就是好。再其次是啥我编不出来了。

但也有缺点... 就是 CYF 开启的时候有个 mod 菜单啥的。可能某些想做全流程的膈应这个吧。我也不清楚 CYF 现在能不能配置默认启动项... 但无所谓，我会出手。

如果说 CYF 把 mod 按照菜单列出，是“分类包装”，那咱就是“塑料包装”，让用户用配置菜单...之类的东西，选择默认启动项，然后打开游戏就是对应的项目。哇哦，这不挺好的么？

当然也可以配置成显示 mod 列表啥的...哎呀，再说吧。反正我的第一意向就是，可以配置默认启动的脚本项目。

对的，我们也不叫 mod... 叫 project。项目。嗯哼。

## 包装纸上有什么？

有没有千禧年出生的 bro，还记得小时候对着那种超市价格表和零食包装看一下午的日子么？

来重温一下童年吧。我们看看这包预制菜的包装纸上写着啥。

下文中的 API 参考 CYF 文档 的编写顺序。默认我写的 API 都是参考 / 近似于 CYF 的 API，而带 ® 标识的是 Souprune 特有（姑且算是特有吧，我说不准）的 API了。

### 术语规范

我的英语烂完了。原作代码里面用了哪些术语我压根不知道。然后社区用什么术语我以前也不知道，也没人问过我啊。写UCT的时候还闹过 choice 写成 choihe 的笑话，哈哈哈，哈，哈。

好在 CYF 给了一套术语命名规范。我们基本参考它来做所有工作：

- **arena**: 战斗框，玩家被允许在其中移动的白色方框内部区域。
- **bullet**: 弹幕。每回合中可能与玩家发生碰撞的物体。[^1]
- **encounter text**: 遭遇战文本，也就是战斗内旁白。在选择战斗/行动/物品/饶恕选项前显示的文本。[^2]
- **monster dialogue**: 怪物对话。遭遇战中怪物所说的文本，通常在攻击前出现。特殊遭遇战中也可能出现多个对话框。
- **dialog**: 玩家对话框组件。"dialog"与"dialogue"的区别在于："dialog"指包含文本的界面窗口，而"dialogue"指怪物的对话内容。
- **wave**: 波次。指单次攻击行为（或称攻击"波次"），计算时间从你开始防御直到攻击停止。Unitale 通过"波次脚本"处理攻击；当存在多个怪物时，你可以同时使用多个波次脚本。[^3]
- **overworld**: 主世界。地图场景。我一般在中文语境下也用英语 overworld 来称呼。
- **debug (feature)®**: 调试模式 feature。这是 Souprune 的一个 feature（Rust 可选编译功能）。开发者只能使用开启了该 feature 的发行版才能启用调试选项。
- **lua (feature)®**: lua 脚本 feature。这是 Souprune 的一个 feature（Rust 可选编译功能）。开发者只能使用开启了该 feature 的发行版才能使用 lua 编写脚本。发行版默认开启 lua feature。
- **dotnet (feature)®**: dotnet 脚本 feature。这是 Souprune 的一个 feature（Rust 可选编译功能）。开发者只能使用开启了该 feature 的发行版才能使用 C#、VB、F# 编写脚本。
- **col (feature)®**: col 脚本 feature。这是 Souprune 的一个 feature（Rust 可选编译功能）。开发者只能使用开启了该 feature 的发行版才能使用 gml / col 编写脚本。

CYF 的 Safe mode （我觉得应该叫 Filtered Mode 更好...）将会在 mortar 中实现。

[^1]: Overworld 追逐战里面可能与玩家碰撞的物体也算弹幕®

[^2]:在 UCT 中，我把这个称为 narrator。这可能会保留于API®

[^3]:这很类似于回合的概念，但是更具体到了怪物身上。在 UCT 中，回合称为 turn，且分为“战斗回合”和“怪物回合”。这里的wave贴近于“怪物回合”的设计。我们可能会参考一小部分 UCT 的设计，如把“战斗回合”改为“全局波次”

### 营养成分表

我缺的 API 的营养这块的谁给我补啊？

#### 特殊变量 / 方法

- GetPlatform 获取当前的系统/平台

---

企划时间：2025-11-16

开始时间：

完成时间：